<!DOCTYPE html>
<html lang="hu">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>LOP Hibalista - Teljes Magyar Le√≠r√°s</title>
    <style>
        :root {
            --primary-color: #0056b3;
            --bg-color: #f4f7f6;
            --card-bg: #ffffff;
            --text-color: #212529;
            --gray-border: #ccc;
            --green-success: #d4edda;
            --green-border: #28a745;
            --gray-left-border: #6c757d;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background-color: var(--bg-color);
            color: var(--text-color);
            margin: 0;
            padding: 20px;
        }

        .container {
            max-width: 1000px;
            margin: 0 auto;
            padding-bottom: 50px;
        }

        header {
            text-align: center;
            margin-bottom: 30px;
        }

        h1 {
            color: var(--primary-color);
            margin-bottom: 5px;
        }
        
        .subtitle {
            color: #666;
            margin-bottom: 20px;
            font-size: 0.9em;
        }

        .action-bar {
            display: flex;
            justify-content: center;
            gap: 10px;
            margin-bottom: 20px;
            flex-wrap: wrap;
        }

        button {
            padding: 8px 16px;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            font-weight: 600;
            transition: background 0.2s;
            font-size: 0.9em;
        }

        .btn-save { background-color: var(--primary-color); color: white; }
        .btn-save:hover { background-color: #004494; }

        .btn-load { background-color: #6c757d; color: white; }
        .btn-load:hover { background-color: #5a6268; }

        .btn-reset { background-color: #dc3545; color: white; }
        .btn-reset:hover { background-color: #c82333; }

        .stats-bar {
            background: white;
            padding: 15px;
            border-radius: 8px;
            box-shadow: 0 2px 5px rgba(0,0,0,0.1);
            display: flex;
            justify-content: space-around;
            margin-bottom: 20px;
            font-weight: bold;
        }

        .stat-item span { display: block; font-size: 0.85em; color: #666; text-transform: uppercase; letter-spacing: 0.5px; }
        .stat-item strong { font-size: 1.5em; color: var(--primary-color); }

        .search-box {
            width: 100%;
            padding: 15px;
            font-size: 16px;
            border: 1px solid #ddd;
            border-radius: 8px;
            margin-bottom: 20px;
            box-sizing: border-box;
            box-shadow: 0 2px 5px rgba(0,0,0,0.05);
        }

        .list-container {
            display: flex;
            flex-direction: column;
            gap: 15px;
        }

        .card {
            background-color: var(--card-bg);
            border-radius: 8px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.08);
            display: flex;
            align-items: stretch;
            padding: 0;
            transition: all 0.2s ease;
            cursor: pointer;
            overflow: hidden;
            border: 1px solid transparent;
        }

        .card.pending {
            border-left: 6px solid var(--gray-left-border);
            background-color: #fff;
        }
        
        .card.pending:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 16px rgba(0,0,0,0.1);
            border-color: #e0e0e0;
        }

        .card.done {
            border-left: 6px solid var(--green-border);
            background-color: #f8fff9;
            opacity: 0.85;
        }

        .card-id {
            background-color: #f8f9fa;
            padding: 15px;
            font-weight: 700;
            font-size: 1.1em;
            min-width: 50px;
            display: flex;
            align-items: center;
            justify-content: center;
            border-right: 1px solid #eee;
            color: #555;
        }
        
        .card.done .card-id {
            background-color: rgba(40, 167, 69, 0.1);
            color: var(--green-border);
        }

        .card-content {
            flex-grow: 1;
            padding: 15px;
            display: flex;
            flex-direction: column;
            justify-content: center;
        }

        .card-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 8px;
        }

        .location-badge {
            background-color: #007bff;
            color: white;
            padding: 4px 8px;
            border-radius: 4px;
            font-size: 0.85em;
            font-weight: bold;
        }

        .problem-text {
            font-size: 1em;
            line-height: 1.5;
            color: #333;
            white-space: pre-wrap; /* Hogy a sort√∂r√©sek megmaradjanak */
        }

        .checkbox-area {
            padding: 0 20px;
            display: flex;
            align-items: center;
            justify-content: center;
            border-left: 1px solid #eee;
            background-color: #fafafa;
        }

        .custom-checkbox {
            width: 26px;
            height: 26px;
            border: 2px solid #adb5bd;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.2s;
            background: white;
        }

        .card.done .custom-checkbox {
            background-color: var(--green-border);
            border-color: var(--green-border);
        }

        .custom-checkbox::after {
            content: '‚úì';
            color: white;
            font-size: 16px;
            font-weight: bold;
            display: none;
        }

        .card.done .custom-checkbox::after { display: block; }
        
        #toast {
            visibility: hidden;
            min-width: 250px;
            margin-left: -125px;
            background-color: #333;
            color: #fff;
            text-align: center;
            border-radius: 4px;
            padding: 16px;
            position: fixed;
            z-index: 100;
            left: 50%;
            bottom: 30px;
            font-size: 16px;
            box-shadow: 0 4px 12px rgba(0,0,0,0.3);
        }

        #toast.show {
            visibility: visible;
            animation: fadein 0.5s, fadeout 0.5s 2.5s;
        }

        @keyframes fadein { from {bottom: 0; opacity: 0;} to {bottom: 30px; opacity: 1;} }
        @keyframes fadeout { from {bottom: 30px; opacity: 1;} to {bottom: 0; opacity: 0;} }

        @media (max-width: 600px) {
            .card { flex-direction: column; }
            .card-id { border-right: none; border-bottom: 1px solid #eee; width: auto; justify-content: flex-start; padding: 10px 15px; }
            .checkbox-area { position: absolute; top: 12px; right: 15px; border: none; background: transparent; padding: 0; }
            .card-content { padding-top: 10px; }
        }
    </style>
</head>
<body>

<div class="container">
    <header>
        <h1>LOP Hibalista - Teljes</h1>
        <p class="subtitle">Automatikus ment√©s akt√≠v | R√©szletes magyar le√≠r√°sok</p>

        <div class="action-bar">
            <button class="btn-save" onclick="downloadState()">üíæ Ment√©s F√°jlba</button>
            <button class="btn-load" onclick="document.getElementById('fileInput').click()">üìÇ Bet√∂lt√©s</button>
            <button class="btn-reset" onclick="resetAll()">üóëÔ∏è Reset</button>
            <input type="file" id="fileInput" style="display: none;" onchange="loadFromFile(this)">
        </div>
    </header>

    <div class="stats-bar">
        <div class="stat-item">
            <span>√ñsszes</span>
            <strong id="total-count">0</strong>
        </div>
        <div class="stat-item">
            <span>K√©sz</span>
            <strong id="done-count" style="color: var(--green-border);">0</strong>
        </div>
        <div class="stat-item">
            <span>H√°tral√©v≈ë</span>
            <strong id="pending-count" style="color: var(--gray-left-border);">0</strong>
        </div>
    </div>

    <input type="text" id="searchInput" class="search-box" placeholder="Keres√©s: ID, Helysz√≠n vagy sz√∂vegr√©szlet...">

    <div id="listContainer" class="list-container">
        </div>
</div>

<div id="toast">Mentve!</div>

<script>
    // AZ ADATOK - TELJES MAGYAR LE√çR√ÅSSAL
    const initialData = [
        {id: 662, loc: "UB35", desc: "A kapcsol√°si rajz szerint nincs pontos karakterisztika megadva n√©melyik r√©sztvev≈ë Locc box√°hoz. (Nem ismert, mely r√©sztvev≈ëk azok >> COMAN-ba r√∂gz√≠t√©s el≈ëtt javasolt a pont L2,5-L3 ellen≈ërz√©se.)"},
        {id: 663, loc: "UB35", desc: "Az √©rt√©kek j√≥k, viszont az UB35 660VR001 NC lok√°tor Locc Box√°nak 002-es modulj√°nak nincs nyom√≥gombja. M√©g mindig nincs nyom√≥gombja."},
        {id: 711, loc: "HC35", desc: "005LE_001-MA1 f√©kellen√°ll√°sa nem j√≥l van felszerelve. (V√≠zszintesen √°ll pedig f√ºgg≈ëlegesen kellene neki). A csatlakoz√°s √°rny√©kolt Lenze rendszerk√°bellel lett kivitelezve?"},
        {id: 712, loc: "HC35", desc: "010DT_009-MA1 geber k√°bel √°rny√©kol√°s√°r√≥l hi√°nyzik a r√©z szalag, illetve m√©g a gy√°ri m≈±anyag f√≥lia sincs lev√°lasztva."},
        {id: 713, loc: "HC35", desc: "10DT009-n√©l 20m-es motork√°bel van, viszont nincsen h√°l√≥zati sz≈±r≈ë a frekvenciav√°lt√≥n."},
        {id: 714, loc: "HC35", desc: "401-es f≈ë k√©ses biztos√≠t√©kok (QB1) a dokument√°ci√≥ szerint 315A-nak kellene lennie, de a val√≥s√°gban 200A-os biztos√≠t√©kok vannak bent.\nValamint az √∂sszes NC lok√°tor caparoc-ja 8A-re van be√°ll√≠tva √©s 10A-re kellene."},
        {id: 715, loc: "HC35", desc: "8A-re van √°ll√≠tva (Locc Box)."},
        {id: 716, loc: "HC35", desc: "Nem megfelel≈ë √©rt√©kek vannak felv√©ve (offset helyett abszol√∫t poz√≠ci√≥√©rt√©k)."},
        {id: 717, loc: "HC36", desc: "NC lok√°tor f≈ëkapcsol√≥ ut√°ni burkolat hi√°nya!"},
        {id: 718, loc: "HC36", desc: "Legels≈ë biztos√≠t√©k nem egyezik az el≈ë√≠rttal. (Szelektivit√°s rendben van?)"},
        {id: 719, loc: "HC36", desc: "Nem megfelel≈ë, a 402 √ºres. (Biztos√≠t√©kok √©s megszak√≠t√≥k √°ram√©rt√©ke √©s karakterisztik√°ja a kapcsol√°si rajz szerinti?)"},
        {id: 720, loc: "HC36", desc: "8A-re van √°ll√≠tva (Locc Box)."},
        {id: 721, loc: "HC36", desc: "Abszol√∫t poz√≠ci√≥ √©rt√©kek vannak felv√©ve."},
        {id: 722, loc: "HC36", desc: "Nem √°tl√°that√≥. Topol√≥gia a TIA-ban nem standard, nincs keresztez√©s a PN vonalon."},
        {id: 723, loc: "HC37", desc: "H101 szekr√©ny: Szikszalag az optikai csatlakoz√≥kn√°l."},
        {id: 724, loc: "HC37", desc: "Nem megfelel≈ë biztos√≠t√©k/megszak√≠t√≥ √°ram√©rt√©kek."},
        {id: 725, loc: "HC37", desc: "10A van √°ll√≠tva. (Sz√∫r√≥pr√≥baszer≈± ellen≈ërz√©s: kapcsol√°si √°ll√°s 10/5, 10A √©s tehetetlens√©g 3)."},
        {id: 726, loc: "HC37", desc: "8A-ra van √°ll√≠tva."},
        {id: 727, loc: "HC38", desc: "Nem egyeznek az online √©s offline adatok 010DT-n√©l."},
        {id: 728, loc: "HC38", desc: "T√∂bbn√©l nem stimmel. 401 nem stimmel. 402 √ºres. (Biztos√≠t√©kok nem egyeznek az EPLAN-nal)."},
        {id: 729, loc: "HC38", desc: "Nincs offset √©rt√©k felv√©ve."},
        {id: 730, loc: "HC38", desc: "Nem √°tl√°that√≥. Topol√≥gia a TIA-ban NIO. Nincs keresztez√©s a PN vonalon. K√©rj√ºk a PRL betart√°s√°t!"},
        {id: 731, loc: "HC39", desc: "001KH_001 online √©s offline adatok nem egyeznek."},
        {id: 732, loc: "HC39", desc: "401 nem egyezik, 402 √ºres, 403 NIO. (Biztos√≠t√©kok nem egyeznek az EPLAN-nal)."},
        {id: 733, loc: "HC39", desc: "Nem √°tl√°that√≥. Topol√≥gia a TIA-ban NIO, nincs keresztez√©s a PN vonalon."},
        {id: 734, loc: "UG36", desc: "010BR_001 nincsen sehol sem felt√ºntetve."},
        {id: 804, loc: "VB35", desc: "NC lok√°tor bet√°p ut√°n nincs v√©d≈ëburkolat."},
        {id: 805, loc: "VB35", desc: "080sgm009 nincs vakdug√≥."},
        {id: 806, loc: "VB35", desc: "Nem egyezik egyik szekr√©nyben sem. (Biztos√≠t√©kok √©s megszak√≠t√≥k √°ram√©rt√©ke)."},
        {id: 807, loc: "VB35", desc: "8A van √°ll√≠tva."},
        {id: 808, loc: "VB35", desc: "Nem el√©rhet≈ëek az offset √©rt√©kek."},
        {id: 809, loc: "VB36", desc: "Nem megfelel≈ë. 402-esben nincs biztos√≠t√©k. Dokumentum alapj√°n 3.15A-snak kell benne lennie."},
        {id: 810, loc: "VB36", desc: "Nem megfelel≈ë. 402-esben nincs biztos√≠t√©k. Dokumentum alapj√°n 3.15A-snak kell benne lennie. (Duplik√°lt t√©tel a list√°ban)."},
        {id: 811, loc: "VB36", desc: "8A van √°ll√≠tva."},
        {id: 812, loc: "VB36", desc: "8A van √°ll√≠tva."},
        {id: 813, loc: "VB37", desc: "H011-ben vannak elt√©r√©sek a felt√ºntetett √©s a val√≥di √°ram√©rt√©kek k√∂z√∂tt.\nA motorv√©d≈ë kapcsol√≥knak nincs felt√ºntetett √©rt√©ke amivel √∂ssze tudn√°nk hasonl√≠tani.\nH112 caparoc-okn√°l nincs felt√ºntetve az √°ram√©rt√©k, nem tudtuk ellen≈ërizni.\n001KL101 mind 8 amperra van √°ll√≠tva, de rajz szerint m√°sra kellene √°ll√≠tva lennie.\nH001-ben a 618, 619, 620 biztos√≠t√≥k nincsenek a kapcsol√°si rajzban felt√ºntetve."},
        {id: 814, loc: "VB37", desc: "H211 caparoc √°ram√©rt√©kek nincsenek felt√ºntetve a kapcsol√°si rajzban, nem tudtuk ellen≈ërizni (E-planban nincs √©rt√©k)."},
        {id: 815, loc: "QS35", desc: "Hajt√°s szekr√©nyeken nincs t√∫lfoly√≥ tart√°ly."},
        {id: 816, loc: "QS35", desc: "501-510 szigetel≈ë szalaggal van tervjelezve.\n000ee_001 h001 nincs feljel√∂lve."},
        {id: 817, loc: "QS35", desc: "QB1 √©rt√©ke nem szerepel a darablist√°ban. Eplanban 400A van felt√ºntetve, 160A van benn√ºk."},
        {id: 818, loc: "QS35", desc: "T√∂bb elt√©r√©s. (Nagyon sok be√°ll√≠tott √°ram√©rt√©k nem egyezik a kapcsol√°si rajzzal)."},
        {id: 819, loc: "UG35", desc: "Nem egyeznek (Param√©terk√©szletek / projektadatok)."},
        {id: 820, loc: "UG35", desc: "T√∂bb elt√©r√©s. (T√∂bb biztos√≠t√©k nem egyezik a kapcsol√°si rajzzal)."},
        {id: 821, loc: "UG35", desc: "Csak 5A van haszn√°lva, konfig elt√©r az el≈ë√≠rtt√≥l."},
        {id: 822, loc: "UG35", desc: "Nincs synchro (adatment√©s)."},
        {id: 823, loc: "UG35", desc: "Nem √°tl√°that√≥. Topol√≥gia NIO, nem a PRL szerint k√©sz√ºlt."},
        {id: 824, loc: "UG35", desc: "Nem megfelel≈ë √©rt√©kek (Locc Box)."},
        {id: 825, loc: "UG35", desc: "Nem √©rhet≈ë el sem a syncro se a gateway konfigur√°ci√≥."},
        {id: 826, loc: "UB32", desc: "GBO Betriebsfunktionen Eredm√©nyek: NG vagy √úres cell√°kat m√©g el kell v√©gezni! (Pap√≠rmentes doku, Mobsy, Profienergy, stb)."},
        {id: 827, loc: "UB33", desc: "GBO Betriebsfunktionen Eredm√©nyek: NG vagy √úres cell√°kat m√©g el kell v√©gezni!"},
        {id: 828, loc: "UB34", desc: "GBO Betriebsfunktionen Eredm√©nyek: NG vagy √úres cell√°kat m√©g el kell v√©gezni!"},
        {id: 829, loc: "UB35", desc: "GBO Betriebsfunktionen Eredm√©nyek: NG vagy √úres cell√°kat m√©g el kell v√©gezni!"},
        {id: 830, loc: "UG35", desc: "GBO Betriebsfunktionen Eredm√©nyek: NG vagy √úres cell√°kat m√©g el kell v√©gezni!"},
        {id: 831, loc: "UG36", desc: "GBO Betriebsfunktionen Eredm√©nyek: NG vagy √úres cell√°kat m√©g el kell v√©gezni!"},
        {id: 832, loc: "QS35", desc: "K√©rlek a t√∫l sok zavart √©s figyelmeztet√©st (l√°sd Top St√∂rungen) az SPS programban ellen≈ërizni √©s jav√≠tani!"},
        {id: 1046, loc: "HC35", desc: "Kein Keba Panel! Stecker Deckel hi√°nyzik!"},
        {id: 1047, loc: "HC35", desc: "Eplan k√©z√≠r√°ssal van kieg√©sz√≠tve! NIO.\nNincs Keba Panel! Stecker Deckel hi√°nyzik!"},
        {id: 1048, loc: "HC35", desc: "Nincs Label az Externe Spannung-hoz (Mitarbeiter Ventil√°tor).\nNincs Keba Panel! Stecker Deckel hi√°nyzik!"},
        {id: 1049, loc: "HC36", desc: "Nincs Label az Externe Spannung-hoz (Mitarbeiter Ventil√°tor).\nNincs Keba Panel! Stecker Deckel hi√°nyzik!"},
        {id: 1050, loc: "HC37", desc: "Nem minden ir√°nyba mozgathat√≥. (Kamera, X-Y-Z)."},
        {id: 1051, loc: "HC37", desc: "Nem minden ir√°nyba mozgathat√≥. (Kamera)."},
        {id: 1052, loc: "HC38", desc: "60dgc109 el≈ëtti v√©d≈ëlemez a spanneren hi√°nyzik."},
        {id: 1053, loc: "HC39", desc: "Nem minden ir√°nyba mozgathat√≥! NIO."},
        {id: 1054, loc: "VB35", desc: "Igen, de pap√≠rra van nyomtatva. (Vesz√©lyes fesz√ºlts√©get jelz≈ë figyelmeztet≈ët√°bla)."},
        {id: 1055, loc: "VB35", desc: "Az optikai k√°bel nem j√≥l van elvezetve."},
        {id: 1056, loc: "HC38", desc: "Nem minden ir√°nyba mozgathat√≥! NIO."},
        {id: 1057, loc: "HC38", desc: "Nincs Keba Panel! Stecker Deckel hi√°nyzik!"},
        {id: 1058, loc: "VB35", desc: "Nincs, hi√°nyos. (Vigy√°zat! A f≈ëkapcsol√≥ lekapcsol√°sa ut√°n is fesz√ºlts√©g alatt)."},
        {id: 1059, loc: "VB35", desc: "EPLAN hi√°nyzik!!! Nincs benne. (Tartalmazza-e a letelep√≠tett NC-locatorokat?)"},
        {id: 1060, loc: "VB36", desc: "80RB100 Schlauchpacket NIO. Nem megfelel≈ë Schlauchpacket van haszn√°lva a roboton."},
        {id: 1061, loc: "VB36", desc: "Kabel NIO, l√°sd k√©p!!!\n080WZA209 mellett ki vagy be√©p√≠t√©s alatt √°ll a 080DGC209. Nem megfelel≈ë k√°belelrendez√©s."},
        {id: 1062, loc: "VB36", desc: "002BR_020: A KP32 plusz nyom√≥gomb vil√°g√≠t."},
        {id: 1063, loc: "VB36", desc: "50GST009-n√©l nem megfelel≈ë, valamint l√°tsz√≥dik a csatlakoz√≥n az emiatti elhaszn√°l√≥d√°s is."},
        {id: 1064, loc: "VB37", desc: "Fent van, de pap√≠r. (Vesz√©lyes fesz√ºlts√©get jelz≈ë t√°bla)."},
        {id: 1065, loc: "VB37", desc: "EPLAN hi√°nyzik!!! Nincs benne."},
        {id: 1066, loc: "VB37", desc: "Az optikai k√°bel nem j√≥l van elvezetve."},
        {id: 1067, loc: "VB37", desc: "(√úres/Duplik√°lt bejegyz√©s - GBO Template)."},
        {id: 1068, loc: "VB37", desc: "Kein Keba Panel! Stecker Deckel hi√°nyzik!"},
        {id: 1069, loc: "VB37", desc: "Nincs, hi√°nyos. (Vigy√°zat! A f≈ëkapcsol√≥ lekapcsol√°sa ut√°n is fesz√ºlts√©g alatt)."},
        {id: 1070, loc: "VB37", desc: "Nincs benne (EPLAN)."},
        {id: 1071, loc: "UG35", desc: "Nincsen. (Vigy√°zat! A f≈ëkapcsol√≥ lekapcsol√°sa ut√°n is fesz√ºlts√©g alatt c√≠mke)."},
        {id: 1072, loc: "UG35", desc: "Nincsen. (A f≈ë bet√°p szekr√©ny c√≠mk√©je r√∂gz√≠tve van? +H011)."},
        {id: 1073, loc: "UG35", desc: "Z tengely fix, 150dgc egy spanneren van."},
        {id: 1074, loc: "UG35", desc: "150dgc spanneren van. (Rezg√©sekre √©rz√©ketlen?)"},
        {id: 1075, loc: "QS35", desc: "Nem minden ir√°nyba mozgathat√≥! NIO."},
        {id: 1076, loc: "QS35", desc: "Nincs Keba Panel! Stecker Deckel hi√°nyzik!"},
        {id: 1077, loc: "UG35", desc: "150dgc spanneren van NIO. (Kamera k√ºls≈ë er≈ëbehat√°sok ellen v√©dett?)"},
        {id: 1078, loc: "UG35", desc: "150dgc nem megfelel≈ë. (A Band3 25-√∂s fejezetben l√©v≈ë le√≠r√°s alapj√°n lett ki√©p√≠tve?)"}
    ];

    let lopData = JSON.parse(JSON.stringify(initialData));
    
    // UI ELEMEK
    const listContainer = document.getElementById('listContainer');
    const searchInput = document.getElementById('searchInput');
    const totalEl = document.getElementById('total-count');
    const doneEl = document.getElementById('done-count');
    const pendingEl = document.getElementById('pending-count');

    // INICIALIZ√ÅL√ÅS
    function init() {
        loadProgress(); // Ment√©s bet√∂lt√©se LocalStorage-b√≥l
        renderList(lopData);
        updateStats();
    }

    // --- MENT√âS √©s BET√ñLT√âS LOGIKA (LocalStorage) ---

    function loadProgress() {
        const saved = localStorage.getItem('lopProgress');
        if (saved) {
            try {
                const savedState = JSON.parse(saved);
                lopData.forEach(item => {
                    if (savedState[item.id]) { item.done = true; }
                });
            } catch (e) { console.error("Hiba a bet√∂lt√©skor:", e); }
        }
    }

    function saveProgress() {
        const stateToSave = {};
        lopData.forEach(item => { if (item.done) stateToSave[item.id] = true; });
        localStorage.setItem('lopProgress', JSON.stringify(stateToSave));
    }

    function resetAll() {
        if(confirm("Biztosan t√∂r√∂lni akarod az √∂sszes pip√°t? Ezt nem lehet visszavonni!")) {
            lopData.forEach(item => item.done = false);
            saveProgress();
            renderList(lopData);
            updateStats();
        }
    }

    // --- F√ÅJL M≈∞VELETEK ---

    function downloadState() {
        const stateToSave = {};
        lopData.forEach(item => { if (item.done) stateToSave[item.id] = true; });
        const dataStr = "data:text/json;charset=utf-8," + encodeURIComponent(JSON.stringify(stateToSave));
        const downloadAnchorNode = document.createElement('a');
        downloadAnchorNode.setAttribute("href", dataStr);
        downloadAnchorNode.setAttribute("download", "lop_allapot_" + new Date().toISOString().slice(0,10) + ".json");
        document.body.appendChild(downloadAnchorNode);
        downloadAnchorNode.click();
        downloadAnchorNode.remove();
        showToast("F√°jl let√∂ltve!");
    }

    function loadFromFile(input) {
        const file = input.files[0];
        if (!file) return;
        const reader = new FileReader();
        reader.onload = function(e) {
            try {
                const savedState = JSON.parse(e.target.result);
                let count = 0;
                lopData.forEach(item => {
                    if (savedState[item.id]) { item.done = true; count++; }
                });
                saveProgress();
                renderList(lopData);
                updateStats();
                showToast(count + " elem bet√∂ltve!");
            } catch (err) { alert("Hiba a f√°jl olvas√°sakor!"); }
        };
        reader.readAsText(file);
        input.value = ''; 
    }

    function showToast(message) {
        const x = document.getElementById("toast");
        x.textContent = message;
        x.className = "show";
        setTimeout(function(){ x.className = x.className.replace("show", ""); }, 3000);
    }

    // --- RENDEREL√âS ---

    function renderList(data) {
        listContainer.innerHTML = '';
        data.forEach(item => {
            const card = document.createElement('div');
            card.className = `card item-card ${item.done ? 'done' : 'pending'}`;
            card.dataset.id = item.id;
            
            card.onclick = (e) => toggleStatus(item.id, card);

            // Sort√∂r√©sek kezel√©se a HTML-ben
            const formattedDesc = item.desc.replace(/\n/g, '<br>');

            card.innerHTML = `
                <div class="card-id">
                    #${item.id}
                </div>
                <div class="card-content">
                    <div class="card-header">
                        <span class="location-badge">${item.loc}</span>
                    </div>
                    <div class="problem-text">
                        ${formattedDesc}
                    </div>
                </div>
                <div class="checkbox-area">
                    <div class="custom-checkbox"></div>
                </div>
            `;
            listContainer.appendChild(card);
        });
    }

    function toggleStatus(id, cardElement) {
        const itemIndex = lopData.findIndex(x => x.id === id);
        if (itemIndex > -1) {
            lopData[itemIndex].done = !lopData[itemIndex].done;
            if (lopData[itemIndex].done) {
                cardElement.classList.remove('pending');
                cardElement.classList.add('done');
            } else {
                cardElement.classList.remove('done');
                cardElement.classList.add('pending');
            }
            updateStats();
            saveProgress();
        }
    }

    function updateStats() {
        const total = lopData.length;
        const done = lopData.filter(x => x.done).length;
        totalEl.textContent = total;
        doneEl.textContent = done;
        pendingEl.textContent = total - done;
    }

    searchInput.addEventListener('input', (e) => {
        const term = e.target.value.toLowerCase();
        const filteredData = lopData.filter(item => 
            item.id.toString().includes(term) || 
            item.loc.toLowerCase().includes(term) || 
            item.desc.toLowerCase().includes(term)
        );
        renderList(filteredData);
    });

    init();
</script>

</body>
</html>
